<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Dashboard - Daily Diary')}"></head>
<body>
<div th:replace="~{fragments/layout :: header}"></div>

<main class="container">
    <div class="paper">
        <div class="page-header">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <h1>Welcome back, <span th:text="${username}">User</span>!</h1>
                    <p class="text-muted">You have <strong th:text="${totalDiaries}">0</strong>
                        <span th:text="${totalDiaries == 1} ? 'entry' : 'entries'">entries</span>
                    </p>
                </div>
            </div>
        </div>

        <div th:replace="~{fragments/alerts :: alerts}"></div>

        <form th:action="@{/diary/dashboard}" method="get" class="search-form">
            <div class="search-input-group">
                <input type="text" name="search" th:value="${searchKeyword}" class="form-control"
                       placeholder="Search your entries...">
                <button type="submit" class="btn">Search</button>
                <a th:href="@{/diary/dashboard}" class="btn" th:if="${searchKeyword}">Clear</a>
            </div>
        </form>

        <div th:if="${searchKeyword}" class="alert alert-info">
            Showing results for "<strong th:text="${searchKeyword}"></strong>"
            (<span th:text="${totalElements}"></span>
            <span th:text="${totalElements == 1} ? 'entry' : 'entries'"></span>)
        </div>

        <div th:if="${#lists.isEmpty(diaries)}" class="empty-state">
            <h3 th:text="${searchKeyword} ? 'No entries found' : 'No diary entries yet'"></h3>
            <p class="text-muted" th:unless="${searchKeyword}">Start writing your thoughts and memories</p>
        </div>

        <div class="grid" th:unless="${#lists.isEmpty(diaries)}">
            <div class="card" th:each="diary : ${diaries}">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                    <small class="text-muted">
                        <span th:text="${#temporals.format(diary.entryDate, 'EEEE, MMM dd, yyyy')}"></span>
                    </small>
                </div>
                <h3 class="card-title">
                    <a th:href="@{/diary/view/{id}(id=${diary.id})}" th:text="${diary.title}"></a>
                </h3>
                <p class="card-text" th:text="${#strings.abbreviate(diary.content, 150)}"></p>
                <small class="text-muted">
                    Updated: <span th:text="${#temporals.format(diary.updatedAt, 'MMM dd, HH:mm')}"></span>
                </small>
                <div class="card-actions">
                    <a class="btn btn-primary btn-compact" th:href="@{/diary/view/{id}(id=${diary.id})}">View</a>
                    <a class="btn btn-outline btn-compact" th:href="@{/diary/edit/{id}(id=${diary.id})}">Edit</a>
                    <form th:action="@{/diary/delete/{id}(id=${diary.id})}" method="post"
                          onsubmit="return confirm('Are you sure you want to delete this entry?');">
                        <button type="submit" class="btn btn-danger btn-compact">Delete</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="pagination" th:if="${totalPages > 1}">
            <a class="btn btn-outline"
               th:if="${hasPrevious}"
               th:href="@{/diary/dashboard(page=${currentPage - 1}, search=${searchKeyword})}">
                Previous
            </a>
            <span class="page-indicator">
                Page <strong th:text="${currentPage}"></strong> of <strong th:text="${totalPages}"></strong>
            </span>
            <a class="btn btn-outline"
               th:if="${hasNext}"
               th:href="@{/diary/dashboard(page=${currentPage + 1}, search=${searchKeyword})}">
                Next
            </a>
        </div>
    </div>
</main>

<div th:replace="~{fragments/layout :: footer}"></div>
</body>
</html>
